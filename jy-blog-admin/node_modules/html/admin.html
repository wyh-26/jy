<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>博客后台</title>
    <style>
        .mabt{
            padding-bottom: 6px;
            padding-top: 6px;
            padding-left: 6px;
            padding-right: 6px;
        }
        .box-center{
            display: flex;

            align-items: center;
        }
        .text-center{

            align-items: center;


        }

        *{
            margin: 0px;
        }
        .border{
            border: solid 1px gainsboro;

        }
    </style>
    <link rel="stylesheet" href="../layui/src/css/layui.css">
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class=" layui-logo layui-hide-xs layui-bg-black">博客管理后台</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <!-- 移动端显示 -->
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left"></i>
            </li>

            <li class="layui-nav-item layui-hide-xs"><a href="">nav 1</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">nav 2</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">nav 3</a></li>
            <li class="layui-nav-item">
                <a href="javascript:;">nav groups</a>
                <dl class="layui-nav-child">
                    <dd><a href="">menu 11</a></dd>
                    <dd><a href="">menu 22</a></dd>
                    <dd><a href="">menu 33</a></dd>
                </dl>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;">
                    <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" class="layui-nav-img">
                    tester
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">Your Profile</a></dd>
                    <dd><a href="">Settings</a></dd>
                    <dd><a href="">Sign out</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item ">
                    <a class="" href="javascript:;">系统管理</a>
                    <dl class="layui-nav-child">
                        <dd class=""><a href="javascript:;">首页管理</a></dd>
                        <dd><a href="javascript:;">关于管理</a></dd>
<!--                        <dd><a href="javascript:;">文章管理</a></dd>-->

                    </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;">文章管理</a>
                    <dl class="layui-nav-child">
                        <dd class="layui-this"><a href="javascript:;">已发布文章</a></dd>
                        <dd><a href="javascript:;">未发布文章</a></dd>

                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">用户管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">管理员管理</a></dd>
                        <dd><a href="javascript:;">用户管理</a></dd>
                    </dl>
                </li>

            </ul>
        </div>
    </div>

    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div id = "all-table" class="layui-tab mabt layui-tab-brief" lay-filter="demo" lay-allowClose="true" style="margin: 0; height: 700px" >
            <ul class="layui-tab-title">
<!--                <li >关于管理</li>-->
                <li class="layui-this">文章管理</li>
<!--                <li>管理员管理</li>-->
                <li>用户管理</li>
<!--                <li>首页管理</li>-->
            </ul>
            <div class="layui-tab-content ">
<!--                <div class="layui-tab-item ">-->
<!--                    <div id="system-mod"></div>-->
<!--                </div>-->
                <div class="layui-tab-item layui-show">
                    <div id="文章管理-mod"></div>
                </div>
<!--                <div class="layui-tab-item">-->
<!--                    <div id="admin-mod"></div>-->
<!--                </div>-->
                <div class="layui-tab-item">
                    <div id="用户管理-mod"></div>
                </div>
<!--                <div class="layui-tab-item">-->
<!--                    <div id = "home-mod"></div>-->
<!--                </div>-->

            </div>
            <div id="page"  style="float: none; width: 100%; display: flex; justify-content: center"  ></div>
        </div>


    </div>

    <div class="layui-footer">
        <!-- 底部固定区域 -->
        底部固定区域
    </div>
</div>

<script src="../layui/src/layui.js"></script>
<script id="文章管理-mode" type="text/html">
    <ul>
        <div class=" layui-btn-container">
            <button type="button"  class=" layui-btn   layui-btn-sm">
                <a href="addArticle.html" target="_blank" style="color: white">写文章</a>
            </button>
            <button type="button" class="layui-btn   layui-btn-sm">搜索文章</button>
        </div>
        <div class="layui-row   box-center border ">
            <div class="layui-col-md1 mabt"></div>
            <div class="layui-col-md1 mabt">

                <div class="text-center">id</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">标题</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">类型</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">发布时间</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">操作</div>
            </div>
            <div class="layui-col-md2 mabt">
                <div class="text-center"></div>
            </div>
        </div>

        {{#  layui.each(d, function(index, item){}}
        <li class=""  style="height: 60px; width: 100%; float: left">
            <div id = "{{item.id}}" class="layui-row box-center" style="height: 60px;">
                <div id="article-id" style="display: none">
                    {{item.id}}
                </div>
                <div class="layui-col-md1  mabt" ></div>
                <div class="layui-col-md1  mabt" >

                    <div class="">{{item.id}}</div>
                </div>
                <div class="layui-col-md2  mabt" >

                    <div class="text-center">{{item.title}}</div>
                </div>
                <div class="layui-col-md2  mabt" >

                    <div class="text-center">{{item.type}}</div>
                </div>
                <div class="layui-col-md2  mabt" >

                    <div class="">{{item.publish_date}}</div>
                </div>
                <div class="layui-col-md3 mabt" >
                    <div class=" layui-btn-container">
                        <button type="button"  class=" layui-btn   layui-btn-sm">
                            <a href="articleContent.html#{{item.id}}" style="color: white" target="_blank">详情</a>
                        </button>
                        <button type="button" class="layui-btn   layui-btn-sm">编辑</button>
                        <button type="submit" class="layui-btn 文章管理-del-btn{{index}} layui-btn-sm" >删除</button>
                    </div>
                </div>
                <div class="layui-col-md1 mabt" >

                </div>
            </div>
        </li>

        {{#});}}
        {{#  if(d.length === 0){}}
        无数据
        {{#}}}
    </ul>
</script>
<script id="用户管理-mode" type="text/html">
    <ul>
        <div class="layui-row   box-center border ">
            <div class="layui-col-md1 mabt"></div>
            <div class="layui-col-md1 mabt">

                <div class="text-center">id</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">头像</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">昵称</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center">签名</div>
            </div>
            <div class="layui-col-md2 mabt">

                <div class="text-center"></div>
            </div>
            <div class="layui-col-md2 mabt">
                <div class="text-center"></div>
            </div>

        </div>
        {{#  layui.each(d, function(index, item){}}
        <li class=""  style="height: 60px;float: left;width: 100% ">
            <div id = "user{{item.id}}" class="layui-row box-center" style="height: 60px;">
                <div class="layui-col-md1  mabt" ></div>
                <div class="layui-col-md1  mabt" >

                    <div class="">{{item.id}}</div>
                </div>
                <div class="layui-col-md2  mabt" >

                    <div class="text-center">{{item.head}}</div>
                </div>
                <div class="layui-col-md2  mabt" >

                    <div class="text-center">{{item.userName}}</div>
                </div>
                <div class="layui-col-md2  mabt" >

                    <div class="">{{item.userTalk}}</div>
                </div>
                <div class="layui-col-md3 mabt" >
                    <div class=" layui-btn-container">
                        <button type="button"  class=" layui-btn   layui-btn-sm">详情</button>
                        <button type="button" class="layui-btn   layui-btn-sm">编辑</button>

                        <button type="submit" class="layui-btn 用户管理-del-btn{{index}} layui-btn-sm" >删除</button>


                    </div>
                </div>
                <div class="layui-col-md1 mabt" >

                </div>
            </div>
        </li>

        {{#});}}
        {{#  if(d.length === 0){}}
        无数据
        {{#}}}
    </ul>
</script>


<script>
    //JS

    layui.use(['element', 'layer', 'util','laypage','laytpl'], function(){
        var element = layui.element
            ,layer = layui.layer
            ,util = layui.util
            ,laypage = layui.laypage
            ,laytpl = layui.laytpl
            ,$ = layui.$;

        //头部事件
        util.event('lay-header-event', {
            //左侧菜单事件
            menuLeft: function(othis){
                layer.msg('展开左侧菜单的操作', {icon: 0});
            }
            ,menuRight: function(){
                layer.open({
                    type: 1
                    ,content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
                    ,area: ['260px', '100%']
                    ,offset: 'rt' //右上角
                    ,anim: 5
                    ,shadeClose: true
                });
            }
        });


        var updateTab = function(page , option){
            var tabTitleThis = document.getElementById("all-table").getElementsByClassName("layui-this")[0];

            var type = tabTitleThis.innerText;
            console.log(type)

            var url = "http://localhost:8080/manager/" + type + "/get/page/";
            $.get(url + page,function(res) {
                var tabContentShow = document.getElementById("all-table").getElementsByClassName("layui-show")[0].getElementsByTagName("div")[0];
                var articleData = res.records;
                console.log(res)
                var articleTpl = document.getElementById(type + "-mode").innerHTML;

                laytpl(articleTpl).render(articleData, function (html) {
                    tabContentShow.innerHTML = html;
                });

                for (var i = 0; i < articleData.length; i++) {

                    console.log(tabContentShow)
                    var articleDom = document.getElementsByClassName(type+"-del-btn" + i)[0];
                    let j = i;
                    articleDom.addEventListener("click", function(){

                        // console.log("传进去的" + j)
                        // console.log(articleData[j])
                        deleteArticle(articleData[j].id);
                    });
                }
                // var delBtn = document.getElementsByClassName("article-del-btn");
                // for(var i = 0; i < delBtn.length; i++){
                //     delBtn[i].onclick = deleteArticle();
                // }

                laypage.render({
                    elem: 'page' //注意，这里的 test1 是 ID，不用加 # 号
                    ,count: res.total //数据总数，从服务端得到
                    ,limit: res.size
                    ,curr: page

                    ,jump: function(obj, first){
                        //obj包含了当前分页的所有参数，比如：
                        // console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                        // console.log(obj.limit); //得到每页显示的条数
                        //
                        // //首次不执行
                        if(!first){
                            //do something
                            console.log("页码发生了变化")
                            updateTab(obj.curr , "change-page");
                        }
                    }
                });
            });
        };
        var initArticle = function(){
            updateTab(1,"change-tab");
        }
        var deleteArticle= function (id){
            //var article = document.getElementById(id);
            console.log("函数接收到的" + id)
            $("#"+id).parent().remove();
            updateTab(1,"change-tab");
            $.ajax({
                url: "http://localhost:8080/manager/文章管理/delete/" + id,
                type: "delete",
                success: function (result) {
                    //$("#div1").html(result);
                }
            });
        }

        initArticle();
        element.on('tab(demo)', function(data){
            // console.log(this); //当前Tab标题所在的原始DOM元素
            // console.log(data.index); //得到当前Tab的所在下标
            // console.log(data.elem); //得到当前的Tab大容器
            initArticle()
        });

    });
</script>


</body>
</html>